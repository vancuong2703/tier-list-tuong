<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tier List Maker - Online Mode</title>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

    <style>
        /* GI·ªÆ NGUY√äN CSS C≈® (M√ÄU TR·∫ÆNG) */
        :root {
            --s-color: #ff7f7f; --a-color: #ffbf7f; --b-color: #ffff7f;
            --c-color: #7fff7f; --d-color: #7fbfff;
            --bg-color: #ffffff; --panel-bg: #f8f9fa; --text-color: #2c3e50;
        }
        body { font-family: sans-serif; background: var(--bg-color); color: var(--text-color); margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        
        /* Ti√™u ƒë·ªÅ */
        .editable-title { text-align: center; margin-bottom: 20px; font-size: 2em; font-weight: bold; border: 1px dashed transparent; cursor: text; }
        .editable-title:hover { border-color: #aaa; background: #f0f0f0; }

        /* N√∫t b·∫•m */
        .controls { background: var(--panel-bg); padding: 15px; border-radius: 8px; margin-bottom: 20px; display: flex; gap: 15px; justify-content: center; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .btn { padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; font-weight: 600; color: white; transition: 0.2s; }
        .btn-upload { background-color: #007bff; }
        .btn-save { background-color: #28a745; }
        input[type=file] { display: none; }

        /* Khu v·ª±c ch·ª•p ·∫£nh */
        #capture-area { background: #fff; padding: 20px; border: 1px solid #ddd; width: 95%; max-width: 1000px; }
        .tier-row { display: flex; margin-bottom: 4px; min-height: 100px; border: 1px solid #ccc; }
        .tier-label { width: 100px; display: flex; justify-content: center; align-items: center; font-size: 24px; font-weight: bold; border-right: 1px solid #ccc; flex-shrink: 0; }
        .tier-container { flex-grow: 1; background: #fcfcfc; display: flex; flex-wrap: wrap; padding: 5px; gap: 5px; }
        
        /* M√†u Tier */
        .label-s { background: var(--s-color); } .label-a { background: var(--a-color); }
        .label-b { background: var(--b-color); } .label-c { background: var(--c-color); }
        .label-d { background: var(--d-color); }

        /* Kho ·∫£nh */
        .pool-section { margin-top: 20px; width: 95%; max-width: 1000px; }
        .pool-container { border: 2px dashed #bbb; min-height: 120px; padding: 10px; display: flex; flex-wrap: wrap; gap: 8px; background: var(--panel-bg); border-radius: 8px; }
        
        /* ·∫¢nh */
        .character-img { width: 75px; height: 75px; object-fit: cover; border-radius: 4px; cursor: grab; border: 1px solid #ddd; background: #fff; }
        .character-img:active { cursor: grabbing; }
        .sortable-ghost { opacity: 0.3; background: #ddd; }
    </style>
</head>
<body>

    <div class="controls">
        <label for="folderLoader" class="btn btn-upload">üìÇ D√πng ·∫£nh kh√°c (Tu·ª≥ ch·ªçn)</label>
        <input type="file" id="folderLoader" webkitdirectory directory multiple />
        <button class="btn btn-save" onclick="downloadTierList()">üì∏ Xu·∫•t ·∫£nh</button>
    </div>

    <div id="capture-area">
        <h1 class="editable-title" contenteditable="true">B·∫£ng X·∫øp H·∫°ng T∆∞·ªõng</h1>
        <div class="tier-row"><div class="tier-label label-s">S</div><div class="tier-container dropzone"></div></div>
        <div class="tier-row"><div class="tier-label label-a">A</div><div class="tier-container dropzone"></div></div>
        <div class="tier-row"><div class="tier-label label-b">B</div><div class="tier-container dropzone"></div></div>
        <div class="tier-row"><div class="tier-label label-c">C</div><div class="tier-container dropzone"></div></div>
        <div class="tier-row"><div class="tier-label label-d">D</div><div class="tier-container dropzone"></div></div>
    </div>

    <div class="pool-section">
        <h3>Kho t∆∞·ªõng</h3>
        <div class="pool-container dropzone" id="image-pool"></div>
    </div>

    <script>
        // ======================================================
        // C·∫§U H√åNH DANH S√ÅCH ·∫¢NH T·ª∞ ƒê·ªòNG LOAD
        // B·∫°n h√£y ƒëi·ªÅn t√™n ch√≠nh x√°c c√°c file ·∫£nh trong th∆∞ m·ª•c "tuong" v√†o ƒë√¢y
        // ======================================================
        const DANH_SACH_TUONG = [
            "tuong (1).png",
            "tuong (10).png",
            "tuong (11).png",
            "tuong (12).png",
            "tuong (13).png",
            "tuong (2).png",
            "tuong (3).png",
            "tuong (4).png",
            "tuong (5).png",
            "tuong (6).png",
            "tuong (7).png",
            "tuong (8).png",
            "tuong (9).png",
            // Th√™m ti·∫øp t√™n file v√†o ƒë√¢y...
        ];
        // ======================================================

        // 1. T·ª∞ ƒê·ªòNG T·∫¢I ·∫¢NH T·ª™ DANH S√ÅCH TR√äN
        const imagePool = document.getElementById('imagePool');
        
        window.onload = function() {
            DANH_SACH_TUONG.forEach(fileName => {
                const img = document.createElement('img');
                // ƒê∆∞·ªùng d·∫´n t∆∞∆°ng ƒë·ªëi: Folder "tuong" n·∫±m c√πng ch·ªó v·ªõi file index.html
                img.src = "./tuong/" + fileName; 
                img.classList.add('character-img');
                img.title = fileName;
                
                // N·∫øu ·∫£nh b·ªã l·ªói (do sai t√™n), ·∫©n n√≥ ƒëi ƒë·ªÉ ƒë·ª° x·∫•u web
                img.onerror = function() { this.style.display = 'none'; console.warn("Kh√¥ng t√¨m th·∫•y ·∫£nh: " + fileName); };
                
                imagePool.appendChild(img);
            });
        };

        // 2. C·∫§U H√åNH K√âO TH·∫¢
        const dropzones = document.querySelectorAll('.dropzone');
        dropzones.forEach(zone => {
            new Sortable(zone, {
                group: 'shared-tierlist',
                animation: 150,
                ghostClass: 'sortable-ghost',
                cursor: 'grabbing'
            });
        });

        // 3. X·ª¨ L√ù N√öT CH·ªåN FOLDER TH·ª¶ C√îNG (GI·ªÆ L·∫†I L√ÄM PH∆Ø∆†NG √ÅN B)
        document.getElementById('folderLoader').addEventListener('change', function(e) {
            const files = e.target.files;
            if (files.length === 0) return;
            // Kh√¥ng x√≥a ·∫£nh c≈© n·ªØa, ch·ªâ th√™m v√†o
            const sortedFiles = Array.from(files).sort((a, b) => a.name.localeCompare(b.name));
            sortedFiles.forEach(file => {
                if (file.type.match('image.*')) {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        const img = document.createElement('img');
                        img.src = event.target.result;
                        img.classList.add('character-img');
                        img.title = file.name;
                        imagePool.appendChild(img);
                    };
                    reader.readAsDataURL(file);
                }
            });
        }, false);

        // C√°c h√†m ph·ª• tr·ª£ kh√°c
        document.querySelector('.editable-title').addEventListener('keydown', function(e) {
            if (e.key === 'Enter') { e.preventDefault(); this.blur(); }
        });

        function downloadTierList() {
            const title = document.querySelector('.editable-title');
            const originalBorder = title.style.border;
            title.style.border = 'none';
            html2canvas(document.getElementById('capture-area'), {
                backgroundColor: "#ffffff", scale: 2, useCORS: true
            }).then(canvas => {
                let fileName = (title.innerText.trim() || 'TierList').replace(/[^a-z0-9]/gi, '_').toLowerCase();
                const link = document.createElement('a');
                link.download = fileName + '.png';
                link.href = canvas.toDataURL('image/png');
                link.click();
                title.style.border = originalBorder;
            });
        }
    </script>
</body>
</html>